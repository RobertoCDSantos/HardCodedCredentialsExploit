from django.shortcuts import render
from django.http import HttpResponse
from django.shortcuts import render, redirect
from django.http import HttpResponse
from .decrypt import decrypt_config_file
from django.shortcuts import render, redirect
import json
import os

def home(request):
    return HttpResponse("Hello, world!")

def dashboard(request):
    return HttpResponse("Welcome to the dashboard!")


def hardcoded_login(request):
    # NÃO SEGURO
    #hardcoded_username = "admin"
    #hardcoded_password = "password123"

    # SEGURO
    decrypted_data = decrypt_config_file(
    'C:\\Users\\Roberto\\Desktop\\UAlg\\PosGraduação CiberSegurança\\1º Semestre\\IDENTIFICAÇÃO, ANÁLISE E EXPLORAÇÃO DE VULNERABILIDADES\\trabalho\\config_encrypted.json', 
    'C:\\Users\\Roberto\\Desktop\\UAlg\\PosGraduação CiberSegurança\\1º Semestre\\IDENTIFICAÇÃO, ANÁLISE E EXPLORAÇÃO DE VULNERABILIDADES\\trabalho\\secret.key'
    )
    config = json.loads(decrypted_data)

    hardcoded_username = config['DJANGO_ADMIN_USERNAME']
    hardcoded_password = config['DJANGO_ADMIN_PASSWORD']

    if request.method == "POST":
        username = request.POST.get('username')
        password = request.POST.get('password')

        if username == hardcoded_username and password == hardcoded_password:
            return redirect('dashboard')  # Redirect to a dashboard or some page
        else:
            return render(request, 'login.html', {'error': 'Invalid credentials'})

    return render(request, 'login.html')
